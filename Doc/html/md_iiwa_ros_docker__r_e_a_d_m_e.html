<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>robetarme-deliverable-wp5: Docker for iiwa_ros</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">robetarme-deliverable-wp5
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Docker for <a class="el" href="namespaceiiwa__ros.html">iiwa_ros</a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This folder holds a docker for <a class="el" href="namespaceiiwa__ros.html">iiwa_ros</a>. This is an out of the box docker infrastructure that allows you to build an image with ros melodic or noetic containing <a class="el" href="namespaceiiwa__ros.html">iiwa_ros</a> and all its dependencies, and sharing the network of the host computer. </p>
<h1><a class="anchor" id="autotoc_md3"></a>
Prerequisite</h1>
<h2><a class="anchor" id="autotoc_md4"></a>
OS</h2>
<p><b>Linux:</b> This docker was developed to be used under Ubuntu. It has been tested on Ubuntu 20.04 but should work with any reasonably recent version. It should also be usable on other Linux-based os but will probably require some adaptations.</p>
<p><b>OS-X:</b> For OSX users, the docker should work. However it is to be expected that the graphical interfaces such as Gazebo will not be working. This might be fixable for specific cases but support is not provided by this package. This is due to the fact that solutions to this may vary a lot depending on the hardware and versions. Also <code>install_docker.sh</code> will most likely not work on OS-X. However the user should be able to recreate by hand the necessary steps.</p>
<p><b>Windows:</b> This will not work under windows. However I would suggest using <a href="https://learn.microsoft.com/en-us/windows/wsl/about">Windows Subsystem for Linux</a> which should allow the user to run this docker on a windows computer. However display sharing issues are still to be expected.</p>
<h2><a class="anchor" id="autotoc_md5"></a>
Network</h2>
<p>The docker container will share the network of the host. So if you plan to use it to communicate with the IIWA robot, you should first make sure that your host network and ports are correctly configured. Check the main README.md for more information about that.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
Nvidia GPU</h2>
<p>Some graphic application (e.g: gazebo9) might need explicit access to your NVIDIA GPU to run without error if you have one. So if you have a NVIDIA GPU, make sure that you have installed a driver and that it is up to date. If you encounter issues with it, try upgrading to the latest LTS driver supported by you GPU. Not that a NVIDIA GPU is not required to run this. The docker should work well even if you don't have one.</p>
<h1><a class="anchor" id="autotoc_md7"></a>
Installation</h1>
<p>To install the necessary dependencies to run this docker you can either do it manually or execute <code>install_docker.sh</code> which will check take you through the installation steps.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
Short cut (recommended)</h2>
<p>Run: </p><div class="fragment"><div class="line">bash install_docker.sh</div>
</div><!-- fragment --><p>This will check which commands are already on your system and propose you to install the missing ones. Unless you have a specific reason to decline, it is strongly suggested to say yes to all installations.</p>
<h2><a class="anchor" id="autotoc_md9"></a>
Manual installation</h2>
<p>If for some reasons you are not able to use the install script, you can install the dependencies by hand.</p>
<ol type="1">
<li>This package requires you to have docker installed. More information about this can be found <a href="https://docs.docker.com/engine/install/">here</a>. If you are on Linux don't forget to run the <a href="https://docs.docker.com/engine/install/linux-postinstall/">post install steps</a></li>
<li>In addition the <code>start_docker.sh</code> script uses a command form <a href="https://github.com/aica-technology/docker-images">aica-technology/docker-images</a> to cut down on code. To install it download the repo and execute <code>scripts/install-aica-docker.sh</code>. This is also a neat command to use is you are developing other dockers.</li>
<li>If you have a NVIDIA GPU you will also need to install <code>nvidia-docker2</code>. Installation instruction can be found <a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html">here</a></li>
</ol>
<h1><a class="anchor" id="autotoc_md10"></a>
Building image</h1>
<p>To build the docker image simply run: </p><div class="fragment"><div class="line">bash build_docker.sh</div>
</div><!-- fragment --><p>This script has a few options that can be used to specify various build variations. The options are: </p><div class="fragment"><div class="line">Usage: ./build.sh [-r, --rebuild] [-v, --verbose] [-i, --image-name] [-d, --distro] [--smid]</div>
<div class="line">Build the epfl-lasa/iiwa_ros  image.</div>
<div class="line">Options:</div>
<div class="line">  -r, --rebuild            Rebuild with --no-cache option.</div>
<div class="line">  -v, --verbose            Display additional info upon build.</div>
<div class="line">  -i, --image-name         Defines the name given to the image beeing built. Default: epfl-lasa/iiwa_ros</div>
<div class="line">  -d, --distro             Can be \&quot;noetic\&quot; or \&quot;melodic\&quot;, default: noetic</div>
<div class="line">  --smid                   Build with smid flags on. Flags are off by default.</div>
<div class="line">  -h, --help               Show this help message.&quot;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md11"></a>
Spinning container</h1>
<p>To run the container, use: </p><div class="fragment"><div class="line">bash start_docker.sh interactive</div>
</div><!-- fragment --><p>This will open the container command prompt. The user is <code>ros</code>, and starts in a ros workspace which is already built and sourced. So you might for example directly input a command such as: </p><div class="fragment"><div class="line">roslaunch iiwa_gazebo iiwa_gazebo.launch</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md12"></a>
Modes</h2>
<p><code>start_docker.sh</code> offers 3 modes.</p>
<ul>
<li><code>interactive</code>: Opens a prompt connected to the container. Stops the container as soon as the prompt is closed</li>
<li><code>server</code>: Starts the container in the background. The container will only be stopped when stopped explicitly or when <code>start_docker</code> is called again with interactive or server. (We always stop the previous docker before starting it again)</li>
<li><code>connect</code>: Allows to connect to the container which was started with the server command. This opens a prompt to the container. You can have as many prompt connected to a server as you want.</li>
</ul>
<h2><a class="anchor" id="autotoc_md13"></a>
Options</h2>
<p>In addition a few options can be used when using <code>start_docker</code>:</p>
<div class="fragment"><div class="line">Usage: ./start_dockers.sh [interactive | server | connect] [-i, --image] [-u, --user]</div>
<div class="line">Build the &#39;${IMAGE_NAME}&#39; image.</div>
<div class="line">Options:</div>
<div class="line">  interactive            Spin the image in the console</div>
<div class="line">  server                 Spin the image as an ssh server</div>
<div class="line">  connect                Connects to an active container</div>
<div class="line">  -i, --image            The name of the image to use to start the container</div>
<div class="line">  -u, --user             Specify the name of the login user. (optional)</div>
<div class="line">  -h, --help             Show this help message and the one from aica-docker</div>
<div class="line">  Additional arguments are passed to the aica-docker command.</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md14"></a>
Technical notes</h1>
<ul>
<li>The docker builds on top of docker images from the <a href="https://github.com/aica-technology/docker-images">aica-docker/docker-images</a>. The install script checks out the And the <code>start_docker.sh</code> script uses their set of command. This might not be the best approach but this works for now so it is good enough. At the time of merging the latest commit working with these script is <a href="https://github.com/aica-technology/docker-images/commit/5f8d9084b2d7b4fb69631b9e69aa72f64d7f7843">5f8d908</a> on main. Although it is likely to work with later commits. Note that the install script will install the <code>aica-docker</code> command from this commit.</li>
<li>The tested base images versions are:<ul>
<li><a href="https://github.com/aica-technology/docker-images/pkgs/container/ros-ws">ros-ws:melodic</a>: sha256:d1ab8c7a5e28dd3fa71ebe051ac0937207adf03215235386a1a0edea855d68d2</li>
<li><a href="https://github.com/aica-technology/docker-images/pkgs/container/ros-ws">ros-ws:noetic</a>: sha256:6c439fedd5b475995187a7206b8cd6f0f2651b809dd689aba5641f3975c61b7f</li>
</ul>
</li>
<li>When building the docker the iiwa-ros repository is cloned into the image. A better approach would probably be to copy it from the host computer. This would likely save a little time at build (who ever does that should also make sure that the .dockerignore is also updated)</li>
<li><code>start_docker.sh</code> checks for NVIDIA GPU and automatically chooses to enable it for the container if it is there. The reason is that it seems gazebo has some issues if there is only an NVIDIA GPU and the container does not have access. But it might still be nice to have an option to override this automatic detection. Also, the output of the command is printed on the terminal, we could do without. Maybe check if there is an NVIDIA driver instead of a physical GPU?</li>
<li>In my case gazebo still outputs an error on the terminal but everything ends up working fine. I think this is partly because gazebo9 and gazebo11 are fairly old. So if everything else works just ignore error messages.</li>
<li>Note that through the <code>build_docker.sh</code> you will forward your git user name and git email to the docker image. This will allow you to push and pull in the docker.</li>
<li>When you build the docker using SIMD flags, the .bashrc in the image is updated to include <code>export ENABLE_SIMD=ON</code>. This enables SIMD for <a class="el" href="namespaceiiwa__ros.html">iiwa_ros</a> without having to write it explicitly at every catkin_make. Just know it's there.</li>
<li><code>start_docker.bash</code> start the docker with <code>--net=host</code> which means the container has the same ip as the host. This enables to share ros communication seemlessly in, out and between containers.</li>
<li>Containers names are hard coded in <code>start_docker.sh</code>. If you want multiple ones on the same machine you need to change manually the container name in the script... Well it's not practical, I didn't think of that... But in the same time, why would you want to do that? Feel free to fix it with an new option to specify container name it you run into this use case</li>
</ul>
<h1><a class="anchor" id="autotoc_md15"></a>
Authors/Maintainers</h1>
<ul>
<li>Loïc Niederhauser: <a href="#" onclick="location.href='mai'+'lto:'+'loi'+'c.'+'nie'+'de'+'rha'+'us'+'er@'+'ep'+'fl.'+'ch'; return false;">loic.<span style="display: none;">.nosp@m.</span>nied<span style="display: none;">.nosp@m.</span>erhau<span style="display: none;">.nosp@m.</span>ser@<span style="display: none;">.nosp@m.</span>epfl.<span style="display: none;">.nosp@m.</span>ch</a>, @niderha on github. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
