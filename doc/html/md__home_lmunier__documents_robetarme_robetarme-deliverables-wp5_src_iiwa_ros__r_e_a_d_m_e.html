<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>robetarme-deliverable-wp5: iiwa_ros</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">robetarme-deliverable-wp5
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="namespaceiiwa__ros.html">iiwa_ros</a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md18"></a>
ROS Stack for KUKA's IIWA robots</h1>
<ul>
<li>Use the Fast Research Interface (FRI) to connect to the robot</li>
<li>Integration with ROS control</li>
<li>Gazebo integration with gravity compensation (similar to real robot)</li>
</ul>
<h1><a class="anchor" id="autotoc_md19"></a>
Requirements</h1>
<p><a class="el" href="namespaceiiwa__ros.html">iiwa_ros</a> requires several packages to be installed in order to work properly:</p>
<ul>
<li><a href="http://www.ros.org">ROS</a> - ROS: tested in <b>Melodic</b> and <b>Kinetic</b>; <em>Indigo</em> should work also</li>
<li><a href="https://github.com/costashatz/kuka_fri">KUKA FRI</a> - This is a modified version of the C++ FRI library provided by KUKA: unfortunately, we cannot release this code, but if you own a KUKA manipulator please contact us in order to acquire this modified library.</li>
<li><a href="http://wiki.ros.org/ros_control">ROS Control</a></li>
<li><a href="http://gazebosim.org/">Gazebo</a> and gazebo-ros-pkgs</li>
<li><a href="https://github.com/jrl-umi3218/SpaceVecAlg">SpaceVecAlg</a></li>
<li><a href="https://github.com/jrl-umi3218/RBDyn">RBDyn</a></li>
<li><a href="https://github.com/jrl-umi3218/mc_rbdyn_urdf">mc_rbdyn_urdf</a></li>
<li><a href="https://github.com/mosra/corrade">corrade</a></li>
<li><a href="https://github.com/epfl-lasa/robot_controllers">robot_controllers</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md20"></a>
Dependencies</h1>
<h2><a class="anchor" id="autotoc_md21"></a>
KUKA FRI (Private)</h2>
<div class="fragment"><div class="line">cd /source/directory</div>
<div class="line">git clone https://github.com/epfl-lasa/kuka_fri.git</div>
<div class="line">cd kuka_fri</div>
<div class="line"># Apply SIMD patch:</div>
<div class="line">wget https://gist.githubusercontent.com/matthias-mayr/0f947982474c1865aab825bd084e7a92/raw/244f1193bd30051ae625c8f29ed241855a59ee38/0001-Config-Disables-SIMD-march-native-by-default.patch</div>
<div class="line">git am 0001-Config-Disables-SIMD-march-native-by-default.patch</div>
<div class="line"># Build</div>
<div class="line">./waf configure</div>
<div class="line">./waf</div>
<div class="line">sudo ./waf install</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md22"></a>
SpaceVecAlg</h2>
<div class="fragment"><div class="line">cd /source/directory</div>
<div class="line">git clone --recursive https://github.com/jrl-umi3218/SpaceVecAlg.git</div>
<div class="line">cd SpaceVecAlg</div>
<div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line">cmake -DCMAKE_BUILD_TYPE=Release -DPYTHON_BINDING=OFF ..</div>
<div class="line">make -j</div>
<div class="line">sudo make install</div>
</div><!-- fragment --><p>To compile with SIMD flags (e.g. because you enabled it for robot_controllers and <a class="el" href="namespaceiiwa__ros.html">iiwa_ros</a>), you can do <code>cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_CXX_FLAGS="-march=native -faligned-new" -DPYTHON_BINDING=OFF ..</code> instead of the above. Also, instead of passing <code>-DCMAKE_CXX_FLAGS="-march=native -faligned-new"</code> for <code>SpaceVecAlg</code>, <code>RBDyn</code> and <code>mc_rbdyn_urdf</code> builds you can also set the <code>CXXFLAGS</code> environment variables and omit the option:</p>
<div class="fragment"><div class="line">export CXXFLAGS=&quot;-march=native -faligned-new&quot;</div>
</div><!-- fragment --><p>The same holds for RBDyn and mc_rbdyn_urdf.</p>
<h2><a class="anchor" id="autotoc_md23"></a>
RBDyn</h2>
<div class="fragment"><div class="line">cd /source/directory</div>
<div class="line">git clone --recursive https://github.com/jrl-umi3218/RBDyn.git</div>
<div class="line">cd RBDyn</div>
<div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line">cmake -DCMAKE_BUILD_TYPE=Release -DPYTHON_BINDING=OFF ..</div>
<div class="line">make -j</div>
<div class="line">sudo make install</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md24"></a>
mc_rbdyn_urdf</h2>
<div class="fragment"><div class="line">cd /source/directory</div>
<div class="line">git clone --recursive https://github.com/jrl-umi3218/mc_rbdyn_urdf.git</div>
<div class="line">cd mc_rbdyn_urdf</div>
<div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line">cmake -DCMAKE_BUILD_TYPE=Release -DPYTHON_BINDING=OFF ..</div>
<div class="line">make -j</div>
<div class="line">sudo make install</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md25"></a>
corrade</h2>
<p>We are using a specific version of Corrade.</p>
<div class="fragment"><div class="line">cd /source/directory</div>
<div class="line">git clone https://github.com/mosra/corrade.git</div>
<div class="line">cd corrade</div>
<div class="line">git checkout 0d149ee9f26a6e35c30b1b44f281b272397842f5</div>
<div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line">cmake ..</div>
<div class="line">make -j</div>
<div class="line">sudo make install</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md26"></a>
robot_controllers</h2>
<div class="fragment"><div class="line">cd /source/directory</div>
<div class="line">git clone https://github.com/epfl-lasa/robot_controllers.git</div>
<div class="line">cd robot_controllers</div>
<div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line">cmake ..</div>
<div class="line">make -j</div>
<div class="line">sudo make install</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md27"></a>
Compilation</h1>
<div class="fragment"><div class="line">cd /path/to/ros_workspace</div>
<div class="line"># source ros workspace</div>
<div class="line">catkin_make</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md28"></a>
Sunrise Robot Application upload</h1>
<p>You need a specific application to run on the robot side. 0. Make sure a Windows laptop is connected on the X66 Ethernet port and has IP <code>172.31.1.42</code> mask <code>255.255.0.0</code></p><ol type="1">
<li>Create a new Sunrise project with Sunrise Workbench and setup an empty RobotApplication template</li>
<li>Setup the safety configuration in <code>SafetyConfiguration.sconf</code> (<a href="https://github.com/IFL-CAMP/iiwa_stack/wiki/safetyconf">example</a>)</li>
<li>Replace the empty template with the <a href="https://github.com/epfl-lasa/iiwa_ros/blob/master/iiwa_driver/java/FRIOverlay.java">online app</a></li>
<li>In <code>StationSetup.cat</code>, tab <code>Software</code>, active the FRI extension, push it to the robot with <code>Installation</code> and accept the reboot question</li>
<li>Synchronise your new Sunrise project to the robot with icon <code>Synchronize project</code></li>
<li>On the Smartpad tablet, your app must be listed in [Applications] and you must also see a new [FRI] tab</li>
</ol>
<h1><a class="anchor" id="autotoc_md29"></a>
Basic Usage</h1>
<h2><a class="anchor" id="autotoc_md30"></a>
Bringup iiwa_driver</h2>
<p><b>Control IIWA with FRI</b></p>
<ol type="1">
<li>Make sure your Linux/ROS laptop is connected on the KONI Ethernet port and has IP <code>192.170.10.1</code> mask <code>255.255.255.0</code>.</li>
<li>On the Smartpad tablet:</li>
</ol>
<ul>
<li>Activate <code>AUT</code> mode (turn key right &gt; AUT &gt; key left)</li>
<li>In <code>[Application]</code>, check yours in order to select it</li>
<li>Press the mechanical <code>Play</code> button ▶</li>
</ul>
<ol type="1">
<li>Within 10 seconds before the timeout, launch: <code>roslaunch iiwa_driver iiwa_bringup.launch</code>. This will connect to IIWA robot using FRI. 4 The Smartpad lets you select control mode and stiffness</li>
<li>Check that everything works if <code>/iiwa/joint_states</code> is being published and reflects the actual robot state.</li>
<li>The Smarpad'd [Application] tab must remain green. Otherwise you can press <code>Play ▶</code> again to reconnect.</li>
</ol>
<p>In case of a hard failure, unload the app by unchecking it in [Application] before retrying.</p>
<h2><a class="anchor" id="autotoc_md31"></a>
Gazebo Simulation</h2>
<p><b>To launch Gazebo with IIWA</b></p>
<div class="fragment"><div class="line">roslaunch iiwa_gazebo iiwa_gazebo.launch</div>
</div><!-- fragment --><p>Both of the above commands will launch IIWA in <b>torque-control mode</b>. To change the control mode (e.g., position-control), please edit the launch files to select the appropriate controller.</p>
<h2><a class="anchor" id="autotoc_md32"></a>
MoveIt planning</h2>
<p>If everything looks in simulation or with the FRI driver, a next step might be to try out your robot with <a href="/iiwa_moveit">MoveIt</a>.</p>
<h1><a class="anchor" id="autotoc_md33"></a>
Documentation</h1>
<p><b>UNDER CONSTRUCTION</b></p>
<h1><a class="anchor" id="autotoc_md34"></a>
Contributing</h1>
<p><b><a class="el" href="namespaceiiwa__ros.html">iiwa_ros</a></b> is being actively developed. Please see <a class="el" href="_c_o_n_t_r_i_b_u_t_i_n_g_8md.html">CONTRIBUTING</a> for more on how to help.</p>
<h1><a class="anchor" id="autotoc_md35"></a>
Acknowledgements</h1>
<p>The URDF description files are copied and refactored from [iiwa_stack] (by Salvatore Virga and Marco Esposito).</p>
<h1><a class="anchor" id="autotoc_md36"></a>
Authors/Maintainers</h1>
<ul>
<li>Konstantinos Chatzilygeroudis (<a href="#" onclick="location.href='mai'+'lto:'+'cos'+'ta'+'sha'+'tz'+'@gm'+'ai'+'l.c'+'om'; return false;">costa<span style="display: none;">.nosp@m.</span>shat<span style="display: none;">.nosp@m.</span>z@gma<span style="display: none;">.nosp@m.</span>il.c<span style="display: none;">.nosp@m.</span>om</a>)</li>
<li>Matthias Mayr (<a href="#" onclick="location.href='mai'+'lto:'+'mat'+'th'+'ias'+'.m'+'ayr'+'@c'+'s.l'+'th'+'.se'; return false;">matth<span style="display: none;">.nosp@m.</span>ias.<span style="display: none;">.nosp@m.</span>mayr@<span style="display: none;">.nosp@m.</span>cs.l<span style="display: none;">.nosp@m.</span>th.se</a>)</li>
<li>Bernardo Fichera (<a href="#" onclick="location.href='mai'+'lto:'+'ber'+'na'+'rdo'+'.f'+'ich'+'er'+'a@e'+'pf'+'l.c'+'h'; return false;">berna<span style="display: none;">.nosp@m.</span>rdo.<span style="display: none;">.nosp@m.</span>fiche<span style="display: none;">.nosp@m.</span>ra@e<span style="display: none;">.nosp@m.</span>pfl.c<span style="display: none;">.nosp@m.</span>h</a>)</li>
</ul>
<h2><a class="anchor" id="autotoc_md37"></a>
Other Contributors</h2>
<ul>
<li>Yoan Mollard (<a href="#" onclick="location.href='mai'+'lto:'+'yoa'+'n@'+'aub'+'ru'+'ne.'+'eu'; return false;">yoan@<span style="display: none;">.nosp@m.</span>aubr<span style="display: none;">.nosp@m.</span>une.e<span style="display: none;">.nosp@m.</span>u</a>)</li>
<li>Walid Amanhoud (<a href="#" onclick="location.href='mai'+'lto:'+'wal'+'id'+'.am'+'an'+'hou'+'d@'+'epf'+'l.'+'ch'; return false;">walid<span style="display: none;">.nosp@m.</span>.ama<span style="display: none;">.nosp@m.</span>nhoud<span style="display: none;">.nosp@m.</span>@epf<span style="display: none;">.nosp@m.</span>l.ch</a>)</li>
</ul>
<h1><a class="anchor" id="autotoc_md38"></a>
Citing iiwa_ros</h1>
<div class="fragment"><div class="line">@software{iiwa2019github,</div>
<div class="line">  author = {Chatzilygeroudis, Konstantinos and Mayr, Matthias and Fichera, Bernardo and Billard, Aude},</div>
<div class="line">  title = {iiwa_ros: A ROS Stack for KUKA&#39;s IIWA robots using the Fast Research Interface},</div>
<div class="line">  url = {http://github.com/epfl-lasa/iiwa_ros},</div>
<div class="line">  year = {2019},</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
